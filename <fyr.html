<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Стабильность Банк</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
        }
        h1, h2, h3 {
            margin-top: 0;
        }
        .players-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .player-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
            position: relative;
        }
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .player-name {
            font-weight: bold;
            font-size: 18px;
        }
        .player-passport {
            color: #666;
            font-size: 14px;
        }
        .balance {
            font-size: 20px;
            margin: 10px 0;
        }
        .positive {
            color: #27ae60;
        }
        .negative {
            color: #e74c3c;
        }
        .fines, .loans {
            margin: 8px 0;
            padding: 5px;
            border-radius: 4px;
            background-color: #fff3f3;
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            cursor: pointer;
            padding: 5px;
            background-color: #eee;
            border-radius: 4px;
        }
        .history {
            margin-top: 5px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        .history.hidden {
            display: none;
        }
        .history-item {
            padding: 5px 0;
            border-bottom: 1px dashed #eee;
        }
        .admin-panel {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border: 1px solid #ddd;
            display: none;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, button {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 20px;
            background-color: #eee;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .tab.active {
            background-color: #3498db;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .edit-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: auto;
            padding: 8px 15px;
            background-color: #2ecc71;
        }
        .repay-all-btn {
            padding: 5px 10px;
            font-size: 12px;
            margin-top: 5px;
            width: auto;
            background-color: #e67e22;
        }
        .clear-history-btn {
            padding: 5px 10px;
            font-size: 12px;
            margin-top: 5px;
            width: auto;
            background-color: #e74c3c;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .action-buttons button {
            flex: 1;
            padding: 8px;
            font-size: 14px;
        }
        .admin-actions {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        .toggle-history-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 18px;
            margin: 0;
            padding: 0 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Стабильность Банк</h1>
            <p>Ваш надежный финансовый партнер</p>
            <button class="edit-btn" id="toggleEditBtn">Редактировать</button>
        </header>

        <h2>Клиенты банка</h2>
        <div class="players-container" id="playersContainer">
            <!-- Здесь будут отображаться карточки игроков -->
        </div>

        <div class="admin-panel" id="adminPanel">
            <div class="tabs">
                <div class="tab active" data-tab="addPlayer">Добавить клиента</div>
                <div class="tab" data-tab="removePlayer">Удалить клиента</div>
                <div class="tab" data-tab="manageFinance">Управление финансами</div>
            </div>

            <div class="tab-content active" id="addPlayer">
                <h3>Добавление нового клиента</h3>
                <div class="form-group">
                    <label for="adminPasswordAdd">Пароль администратора</label>
                    <input type="password" id="adminPasswordAdd" placeholder="Введите пароль">
                </div>
                <div class="form-group">
                    <label for="playerName">Имя</label>
                    <input type="text" id="playerName" placeholder="Введите имя">
                </div>
                <div class="form-group">
                    <label for="playerMiddleName">Отчество</label>
                    <input type="text" id="playerMiddleName" placeholder="Введите отчество">
                </div>
                <div class="form-group">
                    <label for="playerPassport">Паспортные данные</label>
                    <input type="text" id="playerPassport" placeholder="Серия и номер паспорта">
                </div>
                <button onclick="addPlayer()">Добавить клиента</button>
            </div>

            <div class="tab-content" id="removePlayer">
                <h3>Удаление клиента</h3>
                <div class="form-group">
                    <label for="adminPasswordRemove">Пароль администратора</label>
                    <input type="password" id="adminPasswordRemove" placeholder="Введите пароль">
                </div>
                <div class="form-group">
                    <label for="playerToRemove">Выберите клиента для удаления</label>
                    <select id="playerToRemove">
                        <option value="">-- Выберите клиента --</option>
                    </select>
                </div>
                <button onclick="removePlayer()">Удалить клиента</button>
            </div>

            <div class="tab-content" id="manageFinance">
                <h3>Управление финансами клиента</h3>
                <div class="form-group">
                    <label for="adminPasswordFinance">Пароль администратора</label>
                    <input type="password" id="adminPasswordFinance" placeholder="Введите пароль">
                </div>
                <div class="form-group">
                    <label for="selectedPlayer">Выберите клиента</label>
                    <select id="selectedPlayer">
                        <option value="">-- Выберите клиента --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="operationType">Тип операции</label>
                    <select id="operationType">
                        <option value="deposit">Пополнение счета</option>
                        <option value="withdraw">Снятие со счета</option>
                        <option value="fine">Наложить штраф</option>
                        <option value="loan">Выдать кредит</option>
                        <option value="loanRepayment">Погашение кредита</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount">Сумма</label>
                    <input type="number" id="amount" placeholder="Введите сумму">
                </div>
                <div class="form-group">
                    <label for="description">Описание</label>
                    <input type="text" id="description" placeholder="Введите описание операции">
                </div>
                <button onclick="performFinancialOperation()">Выполнить операцию</button>
            </div>
        </div>
    </div>

    <script>
        // Константы
        const ADMIN_PASSWORD = "121212";
        
        // Данные игроков
        let players = JSON.parse(localStorage.getItem('bankPlayers')) || [];
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            renderPlayers();
            updatePlayerDropdowns();
            setupTabs();
            
            // Настройка кнопки редактирования
            document.getElementById('toggleEditBtn').addEventListener('click', function() {
                const adminPanel = document.getElementById('adminPanel');
                if (adminPanel.style.display === 'block') {
                    adminPanel.style.display = 'none';
                    this.textContent = 'Редактировать';
                } else {
                    adminPanel.style.display = 'block';
                    this.textContent = 'Скрыть панель';
                }
            });
        });
        
        // Настройка вкладок
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Убираем активный класс у всех вкладок и контента
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Добавляем активный класс к выбранной вкладке и соответствующему контенту
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
        }
        
        // Обновление выпадающих списков с игроками
        function updatePlayerDropdowns() {
            const removeDropdown = document.getElementById('playerToRemove');
            const financeDropdown = document.getElementById('selectedPlayer');
            
            // Очищаем dropdowns
            removeDropdown.innerHTML = '<option value="">-- Выберите клиента --</option>';
            financeDropdown.innerHTML = '<option value="">-- Выберите клиента --</option>';
            
            // Заполняем dropdowns
            players.forEach(player => {
                const option = document.createElement('option');
                option.value = player.passport;
                option.textContent = `${player.name} ${player.middleName} (${player.passport})`;
                
                removeDropdown.appendChild(option.cloneNode(true));
                financeDropdown.appendChild(option.cloneNode(true));
            });
        }
        
        // Отображение игроков
        function renderPlayers() {
            const container = document.getElementById('playersContainer');
            container.innerHTML = '';
            
            if (players.length === 0) {
                container.innerHTML = '<p>Нет добавленных клиентов</p>';
                return;
            }
            
            players.forEach(player => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                
                // Проверяем, есть ли свойство historyHidden у игрока
                if (player.historyHidden === undefined) {
                    player.historyHidden = false;
                }
                
                playerCard.innerHTML = `
                    <div class="player-header">
                        <div>
                            <div class="player-name">${player.name} ${player.middleName}</div>
                            <div class="player-passport">Паспорт: ${player.passport}</div>
                        </div>
                    </div>
                    <div class="balance ${player.balance >= 0 ? 'positive' : 'negative'}">
                        Баланс: ${player.balance} ₽
                    </div>
                    <div class="fines">
                        Штрафы: ${player.fines} ₽
                        ${player.fines > 0 ? `<button class="repay-all-btn" onclick="repayAllFines('${player.passport}')">Погасить все штрафы</button>` : ''}
                    </div>
                    <div class="loans">
                        Кредиты: ${player.loans} ₽
                        ${player.loans > 0 ? `<button class="repay-all-btn" onclick="repayAllLoans('${player.passport}')">Погасить все кредиты</button>` : ''}
                    </div>
                    <div class="history-header" onclick="toggleHistory('${player.passport}')">
                        <h4>История операций</h4>
                        <button class="toggle-history-btn">${player.historyHidden ? '▼' : '▲'}</button>
                    </div>
                    <div class="history ${player.historyHidden ? 'hidden' : ''}">
                        ${player.history.length ? 
                            player.history.map(record => 
                                `<div class="history-item">${record.date}: ${record.amount} ₽ - ${record.description}</div>`
                            ).join('') : 
                            '<div>Нет операций</div>'
                        }
                        ${player.history.length > 0 ? 
                            `<button class="clear-history-btn" onclick="clearHistory('${player.passport}')">Очистить историю</button>` : 
                            ''
                        }
                    </div>
                `;
                
                container.appendChild(playerCard);
            });
        }
        
        // Переключение отображения истории
        function toggleHistory(passport) {
            const player = players.find(p => p.passport === passport);
            if (player) {
                player.historyHidden = !player.historyHidden;
                savePlayers();
                renderPlayers();
            }
        }
        
        // Очистка истории клиента
        function clearHistory(passport) {
            const password = prompt('Введите пароль администратора:');
            if (password !== ADMIN_PASSWORD) {
                alert('Неверный пароль администратора!');
                return;
            }
            
            const player = players.find(p => p.passport === passport);
            if (!player) {
                alert('Клиент не найден!');
                return;
            }
            
            if (player.history.length === 0) {
                alert('История операций клиента уже пуста!');
                return;
            }
            
            if (confirm('Вы уверены, что хотите очистить всю историю операций этого клиента?')) {
                player.history = [];
                savePlayers();
                renderPlayers();
                alert('История операций успешно очищена!');
            }
        }
        
        // Проверка пароля администратора
        function checkAdminPassword(passwordInputId) {
            const password = document.getElementById(passwordInputId).value;
            if (password !== ADMIN_PASSWORD) {
                alert('Неверный пароль администратора!');
                return false;
            }
            return true;
        }
        
        // Добавление игрока
        function addPlayer() {
            if (!checkAdminPassword('adminPasswordAdd')) return;
            
            const name = document.getElementById('playerName').value;
            const middleName = document.getElementById('playerMiddleName').value;
            const passport = document.getElementById('playerPassport').value;
            
            if (!name || !middleName || !passport) {
                alert('Заполните все поля!');
                return;
            }
            
            // Проверяем, нет ли уже игрока с таким паспортом
            if (players.some(player => player.passport === passport)) {
                alert('Клиент с такими паспортными данными уже существует!');
                return;
            }
            
            // Добавляем нового игрока
            const newPlayer = {
                name,
                middleName,
                passport,
                balance: 0,
                fines: 0,
                loans: 0,
                history: [],
                historyHidden: false
            };
            
            players.push(newPlayer);
            savePlayers();
            renderPlayers();
            updatePlayerDropdowns();
            
            // Очищаем форму
            document.getElementById('playerName').value = '';
            document.getElementById('playerMiddleName').value = '';
            document.getElementById('playerPassport').value = '';
            
            alert('Клиент успешно добавлен!');
        }
        
        // Удаление игрока
        function removePlayer() {
            if (!checkAdminPassword('adminPasswordRemove')) return;
            
            const passport = document.getElementById('playerToRemove').value;
            
            if (!passport) {
                alert('Выберите клиента для удаления!');
                return;
            }
            
            if (confirm('Вы уверены, что хотите удалить этого клиента?')) {
                players = players.filter(player => player.passport !== passport);
                savePlayers();
                renderPlayers();
                updatePlayerDropdowns();
                alert('Клиент успешно удален!');
            }
        }
        
        // Выполнение финансовой операции
        function performFinancialOperation() {
            if (!checkAdminPassword('adminPasswordFinance')) return;
            
            const passport = document.getElementById('selectedPlayer').value;
            const operationType = document.getElementById('operationType').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const description = document.getElementById('description').value;
            
            if (!passport) {
                alert('Выберите клиента!');
                return;
            }
            
            if (!amount || amount <= 0) {
                alert('Введите корректную сумму!');
                return;
            }
            
            if (!description) {
                alert('Введите описание операции!');
                return;
            }
            
            const player = players.find(p => p.passport === passport);
            if (!player) {
                alert('Клиент не найден!');
                return;
            }
            
            // Выполняем операцию в зависимости от типа
            switch(operationType) {
                case 'deposit':
                    player.balance += amount;
                    player.history.unshift({
                        date: new Date().toLocaleString(),
                        amount: +amount,
                        description: description
                    });
                    break;
                    
                case 'withdraw':
                    if (player.balance < amount) {
                        alert('Недостаточно средств на счете!');
                        return;
                    }
                    player.balance -= amount;
                    player.history.unshift({
                        date: new Date().toLocaleString(),
                        amount: -amount,
                        description: description
                    });
                    break;
                    
                case 'fine':
                    player.fines += amount;
                    player.history.unshift({
                        date: new Date().toLocaleString(),
                        amount: -amount,
                        description: `Штраф: ${description}`
                    });
                    break;
                    
                case 'loan':
                    player.loans += amount;
                    player.balance += amount;
                    player.history.unshift({
                        date: new Date().toLocaleString(),
                        amount: +amount,
                        description: `Кредит: ${description}`
                    });
                    break;
                    
                case 'loanRepayment':
                    if (player.loans < amount) {
                        alert('Сумма погашения превышает сумму кредита!');
                        return;
                    }
                    if (player.balance < amount) {
                        alert('Недостаточно средств для погашения кредита!');
                        return;
                    }
                    player.loans -= amount;
                    player.balance -= amount;
                    player.history.unshift({
                        date: new Date().toLocaleString(),
                        amount: -amount,
                        description: `Погашение кредита: ${description}`
                    });
                    break;
            }
            
            savePlayers();
            renderPlayers();
            
            // Очищаем форму
            document.getElementById('amount').value = '';
            document.getElementById('description').value = '';
            
            alert('Операция выполнена успешно!');
        }
        
        // Погашение всех штрафов
        function repayAllFines(passport) {
            const password = prompt('Введите пароль администратора:');
            if (password !== ADMIN_PASSWORD) {
                alert('Неверный пароль администратора!');
                return;
            }
            
            const player = players.find(p => p.passport === passport);
            if (!player) {
                alert('Клиент не найден!');
                return;
            }
            
            if (player.fines <= 0) {
                alert('У клиента нет штрафов для погашения!');
                return;
            }
            
            if (player.balance < player.fines) {
                alert('Недостаточно средств для погашения всех штрафов!');
                return;
            }
            
            if (confirm(`Погасить все штрафы на сумму ${player.fines} ₽?`)) {
                player.balance -= player.fines;
                player.history.unshift({
                    date: new Date().toLocaleString(),
                    amount: -player.fines,
                    description: 'Погашение всех штрафов'
                });
                player.fines = 0;
                
                savePlayers();
                renderPlayers();
                alert('Все штрафы успешно погашены!');
            }
        }
        
        // Погашение всех кредитов
        function repayAllLoans(passport) {
            const password = prompt('Введите пароль администратора:');
            if (password !== ADMIN_PASSWORD) {
                alert('Неверный пароль администратора!');
                return;
            }
            
            const player = players.find(p => p.passport === passport);
            if (!player) {
                alert('Клиент не найден!');
                return;
            }
            
            if (player.loans <= 0) {
                alert('У клиента нет кредитов для погашения!');
                return;
            }
            
            if (player.balance < player.loans) {
                alert('Недостаточно средств для погашения всех кредитов!');
                return;
            }
            
            if (confirm(`Погасить все кредиты на сумму ${player.loans} ₽?`)) {
                player.balance -= player.loans;
                player.history.unshift({
                    date: new Date().toLocaleString(),
                    amount: -player.loans,
                    description: 'Погашение всех кредитов'
                });
                player.loans = 0;
                
                savePlayers();
                renderPlayers();
                alert('Все кредиты успешно погашены!');
            }
        }
        
        // Сохранение данных в localStorage
        function savePlayers() {
            localStorage.setItem('bankPlayers', JSON.stringify(players));
        }
    </script>
</body>
</html>
